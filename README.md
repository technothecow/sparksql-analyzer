# SparkSQL-analyzer
Расширяемый инструмент для разработчиков, позволяющий быстро проводить анализ и рефакторинг SparkSQL-запросов через удобный объектно-ориентированный интерфейс.
# Использованные технологии
 - Python 3.9 (https://www.python.org/)
 - Библиотека Lark (https://github.com/lark-parser/lark)
# Пример использования
Представлен в ```sample.py```
# Инструкция по использованию
### Зависимости
Библиотека Lark из ```requirements.txt```
### Получение дерева синтаксиса
Для получения дерева синтаксиса запроса необходимо импортировать класс ```Analyzer``` из ```analyzer.py```, создать его объект, в качестве аргумента передавая путь к файлу грамматики (```grammar.lark``` по умолчанию) и передать единственным аргументом в метод ```analyze()``` SparkSQL запрос.
### Использование дерева синтаксиса
Вершины дерева могут быть представлены классами ```Tree``` (для правил) и ```Token``` (для терминалов).

У класса ```Tree``` реализованы следующие методы и поля:
 - ```pretty()``` - метод возвращает красивое представление дерева в виде строки
 - ```data``` - поле-строка содержит название правила
 - ```children``` - поле-массив содержит соответствующие подправила данного правила (другие объекты класса ```Tree```) и терминалы (объекты класса ```Token```)

У класса ```Token``` представлены следующие поля:
 - ```type``` - строка с названием терминала
 - ```value``` - строка со значением терминала

### Проверка правильности синтаксиса запроса
Проверить запрос на наличие синтаксических ошибок можно с помощью метода ```check()``` класса ```Analyzer```, передав в качестве единственного аргумента SparkSQL запрос. Функция возвращает ```True``` или ```False``` - отвечая на вопрос, корректен ли запрос.

Узнать, где именно находится ошибка можно отловив ошибку, возникающую при передаче некорректного SparkSQL кода в метод ```analyze()```

### Рефакторинг запроса
Для рефакторинга кода SparkSQL запроса необходимо импортировать класс ```Recreator``` из ```recreator.py```, инициализировать его объект, в качестве аргумента передав дерево синтаксиса и вызвать метод ```recreate()```, который либо вернет строку с обработанным кодом, либо вызовет ошибку о том, что данный запрос восстановить невозможно.

### Расширение грамматики
Расширение грамматики осуществляется через файл грамматики. Краткую инструкцию по написанию грамматики можно найти [здесь](https://lark-parser.readthedocs.io/en/latest/grammar.html).

Для расширения возможностей рефакторинга необходимо дорабатывать функцию ```recreate()``` класса ```Recreator``` в ```recreator.py```.